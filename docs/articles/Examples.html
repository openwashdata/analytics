<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Examples • analytics</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Examples">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">analytics</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Examples.html">Examples</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Examples</h1>
            
      

      <div class="hidden name"><code>Examples.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">analytics</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="get_pscloud_dataspace_id">get_pscloud_data(space_id)<a class="anchor" aria-label="anchor" href="#get_pscloud_dataspace_id"></a>
</h2>
<p>This function retrieves Posit Cloud Data from selected workspace,
which is specified using the space_id parameter. The data returned is in
terms of daily usage. This is the format Posit Cloud returns data in. By
default the function provides usage for the last 365 days. The data is
saved to the data/posit_cloud_data/pscloud.csv. The function does not
return anything.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">space_id</span> <span class="op">&lt;-</span> <span class="fl">123456</span></span>
<span><span class="fu"><a href="../reference/get_pscloud_data.html">get_pscloud_data</a></span><span class="op">(</span>space_id<span class="op">=</span><span class="va">space_id</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get_course_participation_data">get_course_participation_data()<a class="anchor" aria-label="anchor" href="#get_course_participation_data"></a>
</h2>
<p>This functions simply calls and leverages the
<code>ds4owdretention</code> package. The package can be found here: <a href="https://github.com/openwashdata/ds4owdretention" class="external-link uri">https://github.com/openwashdata/ds4owdretention</a>. The
data is saved to data/course_participation/course_participation.csv</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">get_course_participation_data</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get_plausible_datasite_url-pagewise-token">get_plausible_data(site_url, pagewise, token)<a class="anchor" aria-label="anchor" href="#get_plausible_datasite_url-pagewise-token"></a>
</h2>
<p>This function retrieves data from Plausible. The data is pagewise if
pagewise is set to TRUE. The data is saved to
data/plausible_data/plausible.csv. The function does not return
anything. Note: You need to save the API token for Plausible to a
.Renviron file. The instructions to do so can be found here: <a href="https://solutions.posit.co/connections/db/best-practices/managing-credentials/#use-environment-variables" class="external-link uri">https://solutions.posit.co/connections/db/best-practices/managing-credentials/#use-environment-variables</a>.
<strong>Note</strong>: This is not particularly secure, so ensure that
you only store this on a machine that itself is secure and isn’t
accessed by people outside GHE.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">site_url</span> <span class="op">&lt;-</span> <span class="st">"ds4owd-001.github.io/website"</span></span>
<span><span class="va">token</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"TOKEN_NAME"</span><span class="op">)</span></span>
<span><span class="va">pagewise</span> <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># Good idea to leave it to false if you don't want data on each subdomain.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_plausible_data.html">get_plausible_data</a></span><span class="op">(</span>site_url<span class="op">=</span><span class="va">site_url</span>, pagewise<span class="op">=</span><span class="va">pagewise</span>, token<span class="op">=</span><span class="va">token</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get_survey_datasheet_url-service_acc_path-email-n_course_modules">get_survey_data(sheet_url, service_acc_path, email,
n_course_modules)<a class="anchor" aria-label="anchor" href="#get_survey_datasheet_url-service_acc_path-email-n_course_modules"></a>
</h2>
<p>This function retrieves data from a Google Sheet survey of course
participants. The data is saved to data/survey_data/postsurvey.csv. The
function does not return anything. Ideally, service accounts should be
used for authentication, but an email is also fine (see <a href="https://docs.google.com/document/d/1oFFUMNTwMZ8mJrOVbkq7zdJJgiLgeJWA6AmCsugIrEU/edit?tab=t.0" class="external-link">here</a>
for more details). The function picks whichever is available. The
<code>n_course_modules</code> parameter is required in order to
correctly clean the data retrieved and assign it to the correct module.
If the format of the survey changes, the function must also be adapted
accordingly.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sheet_url</span> <span class="op">&lt;-</span> <span class="st">"docs.google.com/spreadsheets/mysheet"</span></span>
<span><span class="va">service_acc_path</span> <span class="op">&lt;-</span> <span class="st">"path/to/service/account.json"</span></span>
<span><span class="va">email</span> <span class="op">&lt;-</span> <span class="st">"jane.doe@ethz.ch"</span></span>
<span><span class="va">n_course_modules</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># Using a service account</span></span>
<span><span class="fu"><a href="../reference/get_survey_data.html">get_survey_data</a></span><span class="op">(</span>sheet_url<span class="op">=</span><span class="va">sheet_url</span>, service_acc_path<span class="op">=</span><span class="va">service_acc_path</span>, n_course_modules<span class="op">=</span><span class="va">n_course_modules</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#OR </span></span>
<span></span>
<span><span class="co">#Using email</span></span>
<span><span class="fu"><a href="../reference/get_survey_data.html">get_survey_data</a></span><span class="op">(</span>sheet_url<span class="op">=</span><span class="va">sheet_url</span>, email<span class="op">=</span><span class="va">email</span>, n_course_modules<span class="op">=</span><span class="va">n_course_modules</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get_metadata_gsheetsheet_url-service_acc_path-email">get_metadata_gsheet(sheet_url, service_acc_path, email)<a class="anchor" aria-label="anchor" href="#get_metadata_gsheetsheet_url-service_acc_path-email"></a>
</h2>
<p>This function retrieves metadata on published data packages that are
currently available on the openwashdata GitHub, from a Google Sheet. The
data is saved to data/metadata/publishing_metadata.csv. The function
does not return anything. Ideally, service accounts should be used for
authentication, but an email is also fine (see <a href="https://docs.google.com/document/d/1oFFUMNTwMZ8mJrOVbkq7zdJJgiLgeJWA6AmCsugIrEU/edit?tab=t.0" class="external-link">here</a>
for more details). The function picks whichever is available.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sheet_url</span> <span class="op">&lt;-</span> <span class="st">"docs.google.com/spreadsheets/mysheet"</span> </span>
<span><span class="va">service_acc_path</span> <span class="op">&lt;-</span> <span class="st">"path/to/service/account.json"</span></span>
<span><span class="va">email</span> <span class="op">&lt;-</span> <span class="st">"jane.doe@gmail.com"</span></span>
<span></span>
<span><span class="co"># Using a service account</span></span>
<span><span class="fu">get_metadata_gsheet</span><span class="op">(</span>sheet_url<span class="op">=</span><span class="va">sheet_url</span>, service_acc_path<span class="op">=</span><span class="va">service_acc_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#OR</span></span>
<span></span>
<span><span class="co">#Using email</span></span>
<span><span class="fu">get_metadata_gsheet</span><span class="op">(</span>sheet_url<span class="op">=</span><span class="va">sheet_url</span>, email<span class="op">=</span><span class="va">email</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get_registrations_datarepo-download_token-github_token">get_registrations_data(repo, download_token, github_token)<a class="anchor" aria-label="anchor" href="#get_registrations_datarepo-download_token-github_token"></a>
</h2>
<p>Data on course registrations was stored in GitHub. To obtain this, we
need to read a raw CSV from GitHub and import it. For this, you first
need access to the repo and your own Github Token as well as a Download
token. Obtaining the download token is requires you to navigate to
GitHub, open the file and click on “View Raw”. Copy the last part of the
URL after <code>?token=</code>. This is the raw token. Currently this is
the only way to get data from this repo, however it is not advisable to
keep using this method as the url can be temporary.</p>
</div>
<div class="section level2">
<h2 id="write_dbuser-password">write_db(user, password)<a class="anchor" aria-label="anchor" href="#write_dbuser-password"></a>
</h2>
<p>Using a user and password with <strong>write</strong> access to the
Postgres database, all data pulled using the previous functions and
saved to the data directory is subsequently written to the Postgres
database. The default port, host and dbname all point to the Postgres
database hosted on ETH servers. It is not intended to be changed
frequently but can be edited in the function call if required.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">user</span> <span class="op">=</span> <span class="st">"janedoe"</span></span>
<span><span class="va">password</span> <span class="op">=</span> <span class="st">"areallystrongpassword"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/write_db.html">write_db</a></span><span class="op">(</span><span class="va">user</span>, <span class="va">password</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="archive_and_clean_dbuserpassword">archive_and_clean_db(user,password)<a class="anchor" aria-label="anchor" href="#archive_and_clean_dbuserpassword"></a>
</h2>
<p><strong>Use this with caution!</strong></p>
<p>This function is intended to to archive old data and import new data
into the existing tables. This should <strong>only</strong> be used if
the previous course ended and a new course was carried out following
which, old data is not required, especially for the dashboard. To run
this function, the user must have <strong>drop</strong> and
<strong>create</strong> permission for the database. Once again, this
function points to the Postgres database hosted on ETH servers.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">archive_and_clean_db</span><span class="op">(</span><span class="va">user</span>,<span class="va">password</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
